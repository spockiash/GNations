@using GNations.Models
@using System.Globalization
<div class="editor-context-container">
    <h2>Editor context</h2>
    <EditForm Model="@ContextModel" OnValidSubmit="Submit" >
        <DataAnnotationsValidator />
        <ValidationSummary />
        <span class="data-member">
            <b>Left:</b>
            <InputNumber  @bind-Value="ContextModel.RelativeLeft" @oninput="LeftChange" />
        </span>
        <span class="data-member">
            <b>Top:</b>
            <InputNumber @bind-Value="ContextModel.RelativeTop" @oninput="TopChange"/>
        </span>
        @if (ContextModel.DisplayScaleInput)
        {
            <span class="data-member">
                <b>Scale:</b>
                <InputNumber @bind-Value="ContextModel.BaseScale" @oninput="ScaleChange"/>
            </span>
        }
        <button type="submit" class="btn-submit">Submit</button>
    </EditForm>


</div>
@code {
    [Parameter]
    public MapDisplayBase ContextModel { get; set; } = new MapDisplayBase();
    [Parameter]
    public EventCallback<MapDisplayBase> OnPositionChange { get; set; }
    [Parameter]
    public EventCallback<MapDisplayBase> OnFormSubmit { get; set; }

    public void Refresh()
    {
        StateHasChanged();
    }

    public async Task Submit()
    {
        await OnFormSubmit.InvokeAsync(ContextModel);
    }

    public async Task LeftChange(ChangeEventArgs args)
    {
        if(args.Value != null)
        {
            ContextModel.RelativeLeft = Convert.ToInt32(args.Value);
            await OnPositionChange.InvokeAsync(ContextModel);
        }
    }

    public async Task TopChange(ChangeEventArgs args)
    {
        if(args.Value != null)
        {
            ContextModel.RelativeTop = Convert.ToInt32(args.Value);
            await OnPositionChange.InvokeAsync(ContextModel);
        }
    }

    public async Task ScaleChange(ChangeEventArgs args)
    {
        if(args.Value != null)
        {
            ContextModel.BaseScale = float.Parse((string)args.Value, CultureInfo.InvariantCulture);
            await OnPositionChange.InvokeAsync(ContextModel);
        }
    }
}
